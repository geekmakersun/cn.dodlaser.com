# 将XunRuiCMS网站英文目录名翻译成中文（安全更新方案）

## 1. 方案调整原因

用户指出数据库目前还存在写入操作，因此不能直接替换整个SQL文件，而需要采用更加安全的方式，只更新需要翻译的目录名字段，避免覆盖正在写入的数据。

## 2. 安全更新方案

### 2.1 核心思路
- 不直接修改缓存的SQL文件，而是直接连接到数据库执行更新操作
- 使用UPDATE语句，只修改需要翻译的目录名字段（`dirname`和`pdirname`）
- 按照从顶层到底层的顺序更新，确保子栏目能正确关联到更新后的上级目录

### 2.2 实施步骤

#### 2.2.1 备份数据库
- 执行数据库备份，确保在出现问题时可以恢复
- 备份命令：`mysqldump -u username -p database_name > backup.sql`

#### 2.2.2 连接到数据库
- 使用MySQL客户端连接到网站数据库
- 命令：`mysql -u username -p database_name`

#### 2.2.3 按照层级顺序更新目录名

##### 2.2.3.1 步骤1：更新一级栏目的`dirname`
```sql
UPDATE dr_1_share_category SET dirname = '关于我们' WHERE dirname = 'about' AND pid = 0;
UPDATE dr_1_share_category SET dirname = '常见问题' WHERE dirname = 'faq' AND pid = 0;
UPDATE dr_1_share_category SET dirname = '新闻动态' WHERE dirname = 'news' AND pid = 0;
UPDATE dr_1_share_category SET dirname = '产品' WHERE dirname = 'products' AND pid = 0;
UPDATE dr_1_share_category SET dirname = '治疗项目' WHERE dirname = 'treatments' AND pid = 0;
```

##### 2.2.3.2 步骤2：更新二级栏目的`pdirname`（上级目录路径）
```sql
UPDATE dr_1_share_category SET pdirname = '产品/' WHERE pdirname = 'products/' AND pid > 0;
UPDATE dr_1_share_category SET pdirname = '治疗项目/' WHERE pdirname = 'treatments/' AND pid > 0;
```

##### 2.2.3.3 步骤3：更新二级栏目的`dirname`
```sql
UPDATE dr_1_share_category SET dirname = '激光套件' WHERE dirname = 'laser' AND pdirname = '产品/';
UPDATE dr_1_share_category SET dirname = '光纤' WHERE dirname = 'fiber' AND pdirname = '产品/';
UPDATE dr_1_share_category SET dirname = '手柄' WHERE dirname = 'handle' AND pdirname = '产品/';
UPDATE dr_1_share_category SET dirname = '配件' WHERE dirname = 'accessories' AND pdirname = '产品/';
UPDATE dr_1_share_category SET dirname = '理疗' WHERE dirname = 'laser_therapy' AND pdirname = '治疗项目/';
UPDATE dr_1_share_category SET dirname = '宠物医疗' WHERE dirname = 'veterinary' AND pdirname = '治疗项目/';
UPDATE dr_1_share_category SET dirname = '美容' WHERE dirname = 'Aesthetic' AND pdirname = '治疗项目/';
UPDATE dr_1_share_category SET dirname = '外科手术' WHERE dirname = 'surgical' AND pdirname = '治疗项目/';
```

##### 2.2.3.4 步骤4：更新三级栏目的`pdirname`（上级目录路径）
```sql
UPDATE dr_1_share_category SET pdirname = '治疗项目/外科手术/' WHERE pdirname = 'treatments/surgical/' AND pid > 0;
UPDATE dr_1_share_category SET pdirname = '治疗项目/美容/' WHERE pdirname = 'treatments/Aesthetic/' AND pid > 0;
UPDATE dr_1_share_category SET pdirname = '治疗项目/理疗/' WHERE pdirname = 'treatments/laser_therapy/' AND pid > 0;
```

##### 2.2.3.5 步骤5：更新三级栏目的`dirname`
```sql
UPDATE dr_1_share_category SET dirname = '静脉激光治疗' WHERE dirname = 'evlt' AND pdirname = '治疗项目/外科手术/';
UPDATE dr_1_share_category SET dirname = '耳鼻喉' WHERE dirname = 'ent' AND pdirname = '治疗项目/外科手术/';
UPDATE dr_1_share_category SET dirname = '经皮激光椎间盘减压术' WHERE dirname = 'pldd' AND pdirname = '治疗项目/外科手术/';
UPDATE dr_1_share_category SET dirname = '痔疮' WHERE dirname = 'hemorrhoids' AND pdirname = '治疗项目/外科手术/';
UPDATE dr_1_share_category SET dirname = '溶脂' WHERE dirname = 'lipolysis' AND pdirname = '治疗项目/美容/';
UPDATE dr_1_share_category SET dirname = '蜘蛛静脉' WHERE dirname = 'spider_vein' AND pdirname = '治疗项目/美容/';
UPDATE dr_1_share_category SET dirname = '物理治疗' WHERE dirname = 'physiotherapy' AND pdirname = '治疗项目/理疗/';
UPDATE dr_1_share_category SET dirname = '灰指甲治疗' WHERE dirname = 'nail_fungal_removal' AND pdirname = '治疗项目/理疗/';
UPDATE dr_1_share_category SET dirname = '牙科' WHERE dirname = 'dentistry' AND pdirname = '治疗项目/外科手术/';
UPDATE dr_1_share_category SET dirname = '妇科' WHERE dirname = 'gynecology' AND pdirname = '治疗项目/外科手术/';
```

#### 2.2.4 刷新CMS缓存
- 登录CMS后台
- 进入“系统”→“缓存管理”
- 点击“更新全站缓存”按钮

#### 2.2.5 验证更新结果
- 检查网站前台，确保所有栏目能正常访问
- 检查URL结构，确保目录名已更新为中文
- 检查所有子栏目是否能正确关联到上级栏目

## 3. 注意事项

1. **执行顺序**：必须按照从顶层到底层的顺序执行更新，先更新一级栏目，再更新二级栏目，最后更新三级栏目
2. **条件限制**：每条UPDATE语句都包含了条件限制，确保只更新目标记录
3. **数据库连接**：确保使用正确的数据库用户名和密码
4. **备份**：一定要先备份数据库，以防出现问题
5. **缓存刷新**：更新完成后必须刷新CMS缓存，否则网站可能无法正常显示
6. **测试**：更新完成后一定要测试网站的所有栏目，确保能正常访问

## 4. 预期结果

- 网站的所有栏目目录名将从英文改为中文
- 二级和三级栏目的上级目录路径会正确更新
- 网站的URL结构将变为中文，例如：
  - 原路径：`/products/laser/` → 新路径：`/产品/激光套件/`
  - 原路径：`/treatments/surgical/` → 新路径：`/治疗项目/外科手术/`
- 网站能正常访问，所有栏目和内容页都能正确显示
- 数据库中正在写入的数据不会被覆盖

## 5. 应急方案

如果更新过程中出现问题，例如网站无法访问或栏目显示异常，可以采取以下应急措施：

1. **恢复数据库备份**：使用备份的数据库文件恢复数据库
   - 命令：`mysql -u username -p database_name < backup.sql`
2. **刷新CMS缓存**：恢复数据库后，登录CMS后台刷新缓存
3. **检查错误日志**：查看CMS的错误日志，定位问题原因
4. **联系技术支持**：如果问题无法解决，联系XunRuiCMS的技术支持寻求帮助

## 6. 替代方案

如果无法直接连接到数据库，可以使用CMS后台的“栏目管理”功能，逐个编辑栏目，修改目录名。这种方式更加安全，但操作步骤较多，适用于栏目数量较少的情况。

### 6.1 后台更新步骤
1. 登录CMS后台
2. 进入“内容”→“栏目管理”
3. 选择需要修改的栏目，点击“编辑”按钮
4. 修改“栏目目录”字段，从英文改为中文
5. 点击“保存”按钮
6. 按照层级顺序，从一级栏目到三级栏目依次修改
7. 修改完成后，刷新CMS缓存

这种方式的优点是操作简单，不需要直接操作数据库，适合非技术人员使用。缺点是如果栏目数量较多，操作步骤会比较繁琐。